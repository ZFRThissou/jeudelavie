<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Jeu de la Vie — 1000×1000</title>
<style>
  html,body{height:100%;margin:0;background:#0b0b0b;color:#eaeaea;font-family:system-ui,Arial}
  #topbar{display:flex;flex-wrap:wrap;gap:8px;padding:8px;background:#0f0f0f;border-bottom:1px solid #141414;align-items:center}
  button,input{font-size:13px;padding:6px 8px;background:#1b1b1b;border:1px solid #272727;color:#eee;border-radius:6px}
  #canvas-wrap{flex:1;display:flex;height:calc(100% - 48px);background:#0b0b0b;overflow:hidden}
  canvas{background:#0b0b0b;display:block;margin:auto;cursor:crosshair}
  .small{font-size:12px;color:#bdbdbd;margin-left:8px}
</style>
</head>
<body>
  <div id="topbar">
    <button id="playPause">▶ Play</button>
    <button id="step">Step</button>
    <button id="clear">Clear</button>
    <button id="rand">Random</button>
    <label>Vitesse <input id="speed" type="range" min="1" max="60" value="10"></label>
    <label>Zoom <input id="zoom" type="range" min="4" max="40" value="12"></label>
    <input id="showGrid" type="checkbox" checked> Grille
    <div class="small" id="info"></div>
  </div>
  <div id="canvas-wrap"><canvas id="c"></canvas></div>
<script>
const W=1000,H=1000;
const canvas=document.getElementById('c');
const ctx=canvas.getContext('2d',{alpha:false});
let cw=canvas.parentElement.clientWidth,ch=canvas.parentElement.clientHeight;
canvas.width=cw;canvas.height=ch;
let cellSize=parseInt(document.getElementById('zoom').value);
let viewX=0,viewY=0,generation=0,fps=10,running=false,showGrid=true;
let alive=new Set();
const idx=(r,c)=>r*W+c;

function clampView(){
  const cols=Math.ceil(cw/cellSize),rows=Math.ceil(ch/cellSize);
  viewX=Math.max(0,Math.min(W-cols,viewX));
  viewY=Math.max(0,Math.min(H-rows,viewY));
}

function draw(){
  ctx.fillStyle="#0b0b0b";ctx.fillRect(0,0,cw,ch);
  const cols=Math.ceil(cw/cellSize),rows=Math.ceil(ch/cellSize);
  ctx.fillStyle="#e6e6e6";
  alive.forEach(k=>{
    const r=Math.floor(k/W),c=k%W;
    const vx=c-viewX,vy=r-viewY;
    if(vx>=0&&vy>=0&&vx<cols&&vy<rows)
      ctx.fillRect(vx*cellSize,vy*cellSize,cellSize-1,cellSize-1);
  });
  if(showGrid&&cellSize>=6){
    ctx.strokeStyle='rgba(255,255,255,0.05)';ctx.beginPath();
    for(let x=0;x<=cols;x++){ctx.moveTo(x*cellSize+0.5,0);ctx.lineTo(x*cellSize+0.5,rows*cellSize);} 
    for(let y=0;y<=rows;y++){ctx.moveTo(0,y*cellSize+0.5);ctx.lineTo(cols*cellSize,y*cellSize+0.5);} 
    ctx.stroke();
  }
  document.getElementById('info').textContent=`Vivantes:${alive.size} Gén:${generation} Zoom:${cellSize}px`;
}

function step(){
  const counts=new Map();
  const inc=(r,c)=>{if(r<0||c<0||r>=H||c>=W)return;const k=idx(r,c);counts.set(k,(counts.get(k)||0)+1)};
  alive.forEach(k=>{
    const r=Math.floor(k/W),c=k%W;
    for(let dr=-1;dr<=1;dr++)for(let dc=-1;dc<=1;dc++)if(dr||dc)inc(r+dr,c+dc);
  });
  const newAlive=new Set();
  counts.forEach((n,k)=>{const was=alive.has(k);if((was&&(n==2||n==3))||(!was&&n==3))newAlive.add(k);});
  alive=newAlive;generation++;draw();
}

function setCell(px,py,aliveState=true){
  const c=viewX+Math.floor(px/cellSize);
  const r=viewY+Math.floor(py/cellSize);
  if(r<0||c<0||r>=H||c>=W)return;
  const k=idx(r,c);
  if(aliveState)alive.add(k);else alive.delete(k);
}

// ---- Events ----
window.addEventListener('resize',()=>{cw=canvas.parentElement.clientWidth;ch=canvas.parentElement.clientHeight;canvas.width=cw;canvas.height=ch;clampView();draw();});

let isPanning=false,isDrawing=false;
let lastPan=null;

canvas.addEventListener('mousedown',e=>{
  if(e.button===0){isDrawing=true;setCell(e.offsetX,e.offsetY,true);draw();}
  if(e.button===2){isPanning=true;lastPan={x:e.clientX,y:e.clientY};}
});
canvas.addEventListener('mousemove',e=>{
  if(isDrawing){setCell(e.offsetX,e.offsetY,true);draw();}
  if(isPanning){const dx=e.clientX-lastPan.x,dy=e.clientY-lastPan.y;lastPan={x:e.clientX,y:e.clientY};viewX-=Math.round(dx/cellSize);viewY-=Math.round(dy/cellSize);clampView();draw();}
});
canvas.addEventListener('mouseup',()=>{isDrawing=false;isPanning=false;});
canvas.addEventListener('contextmenu',e=>e.preventDefault());

// buttons
playPause.addEventListener('click',()=>{running=!running;playPause.textContent=running?'⏸ Pause':'▶ Play';});
stepBtn.addEventListener('click',()=>{if(!running)step();});
clearBtn.addEventListener('click',()=>{alive.clear();generation=0;draw();});
randBtn.addEventListener('click',()=>{for(let i=0;i<2000;i++){alive.add(idx(Math.floor(Math.random()*H),Math.floor(Math.random()*W)));}draw();});
document.getElementById('speed').addEventListener('input',e=>fps=parseInt(e.target.value));
document.getElementById('zoom').addEventListener('input',e=>{cellSize=parseInt(e.target.value);clampView();draw();});
document.getElementById('showGrid').addEventListener('change',e=>{showGrid=e.target.checked;draw();});

// loop
let lastTick=performance.now();
function loop(now){if(running&&now-lastTick>1000/fps){step();lastTick=now;}requestAnimationFrame(loop);}requestAnimationFrame(loop);

draw();
</script>
</body>
</html>
